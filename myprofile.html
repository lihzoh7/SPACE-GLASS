<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
}

.container {
  max-width: 500px;
  margin: auto;
  padding: 20px;
}

h2 {
  text-align: center;
  font-size: 12px;
  margin-bottom: 20px;
}

.section-title {
  font-size: 14px;
  margin-top: 20px;
  margin-bottom: 10px;
  font-weight: bold;
}

input {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
}

input[disabled] {
  background: #e0e0e0;
}

button {
  width: 100%;
  padding: 12px;
  background: green;
  color: white;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #ccc;
  padding: 15px 25px;
  display: none;
}
</style>
</head>

<body>

<div class="container">
  <h2>My Profile</h2>

  <!-- PERSONAL DETAILS -->
  <div class="section-title">Personal Details</div>
  <input id="name" disabled>
  <input id="surname" disabled>
  <input id="idNumber" disabled>
  <input id="email" disabled>
  <input id="nationality" disabled>
  <input id="phone" disabled>
  <input id="address" disabled>
  <input id="suburb" disabled>
  <input id="city" disabled>
  <input id="zip" disabled>

  <!-- BANK DETAILS -->
  <div class="section-title">Bank Details</div>
  <input id="bankName" placeholder="Bank Name">
  <input id="accountNumber" placeholder="Account Number">

  <button onclick="updateBank()">UPDATE</button>
</div>

<div class="popup" id="popup">UPDATED</div>

<script type="module">
import { auth, db } from '../firebase.js';
import {
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
import {
  ref, get, update
} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

/* AUTH GUARD */
onAuthStateChanged(auth, async user => {
  if (!user) {
    location.href = 'https://lihzoh7.github.io/';
    return;
  }

  const snap = await get(ref(db, 'players/' + user.uid));
  if (!snap.exists()) return;

  const data = snap.val();

  /* Personal */
  Object.keys(data.personal).forEach(k => {
    document.getElementById(k).value = data.personal[k];
  });

  /* Bank */
  if (data.bank) {
    bankName.value = data.bank.bankName || '';
    accountNumber.value = data.bank.accountNumber || '';
  }
});

/* UPDATE BANK */
window.updateBank = async () => {
  const user = auth.currentUser;
  if (!user) return;

  await update(ref(db, 'players/' + user.uid + '/bank'), {
    bankName: bankName.value,
    accountNumber: accountNumber.value
  });

  popup.style.display = 'block';
  setTimeout(() => popup.style.display = 'none', 1000);
};
</script>

</body>
</html>
